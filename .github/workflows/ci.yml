name: CI - Code Quality & Tests

on:
    pull_request:
        branches: [main]
    push:
        branches: [main]

jobs:
    quality-check:
        name: Code Quality & Testing
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "18.19.0"
                  cache: "npm"

            - name: Install dependencies
              run: npm ci

            - name: TypeScript Type Check
              run: npm run type-check

            - name: ESLint
              run: npm run lint

            - name: Prettier Format Check
              run: npm run format:check

            - name: Run Tests
              run: npm run test:coverage

            - name: Upload Coverage Reports
              uses: codecov/codecov-action@v3
              with:
                  files: ./coverage/coverage-final.json
                  flags: unittests
                  name: codecov-umbrella

            - name: Comment Test Coverage
              if: github.event_name == 'pull_request'
              uses: romeovs/lcov-reporter-action@v0.3.1
              with:
                  lcov-file: ./coverage/lcov.info
                  github-token: ${{ secrets.GITHUB_TOKEN }}

    quality-summary:
        name: Quality Summary
        runs-on: ubuntu-latest
        needs: quality-check
        if: always()

        steps:
            - name: Summary
              run: |
                  echo "## ðŸŽ· Nia LeSane - Quality Check Results" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "âœ… TypeScript type checking passed" >> $GITHUB_STEP_SUMMARY
                  echo "âœ… ESLint checks passed" >> $GITHUB_STEP_SUMMARY  
                  echo "âœ… Code formatting verified" >> $GITHUB_STEP_SUMMARY
                  echo "âœ… All tests passed with coverage" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "*CEO-level quality maintained* ðŸš€" >> $GITHUB_STEP_SUMMARY
